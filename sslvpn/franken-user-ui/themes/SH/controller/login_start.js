define(["controller/SSLClientController.js","controller/ConnectionController.js","controller/PageController.js","view/"+$g.theme+"/message.res.js"],function(e,t,n,r){var i={},s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w=function(){s=$("div#area_id"),o=$("div#area_confirm"),u=$("div#area_password"),a=$("div#area_error"),f=$("input[type=text]#txt_id"),l=$("input[type=password]#txt_password"),c=$("span.help-block#lbl_confirm"),h=$("span.help-block#lbl_error"),p=$("button#btn_login_start"),d=$("button#btn_login"),v=$("button#btn_another"),m=$("button#btn_lost_password"),btnCertCenter=$("button#btn_cert_center"),btnVersion=$(".s_version")},E=function(){log("init loginstart"),t.CancelLogin(),w(),S(),e.SetHostname(),setTimeout(function(){e.RequestVpnInfo(function(e){i.encryptions=e.encryptions,i.auth_method=e.auth_method,i.internal_ip=e.internal_ip,(e.auth_method===1||e.auth_method===3||e.auth_method===5)&&e.encryptions!=""&&(log("no need to request auth_method"),D(),f.focus(),v.hide(),m.show()),log(e.id_label),e.id_label!=null&&(/^\s*$/.test(e.id_label)||$("label[for=txt_id]").text(e.id_label))})},100),f.focus(),n.preload("view/"+$g.theme+"/page/loading.html",function(e){g=e}),n.preload("view/"+$g.theme+"/page/version.html",function(e){y=e}),n.loadNotice(),$g.noTopImage&&$(".s_top_image").addClass("top_fallback"),$g.noNoticeImage&&$(".s_notice_image").addClass("notice_fallback"),n.linkClientDownload()},S=function(){p.on("click",L),v.on("click",A),d.on("click",O),m.on("click",k),f.on("keydown",N),l.on("keydown",C),btnCertCenter.on("click",T),btnVersion.on("click",x)},x=function(){n.openModal("about:blank",240,function(){$(".modal-iframe").remove();var e=$("<div>").html(y).appendTo(".modal");e.find("#lblverTSGSSL").text(TSGSSL.GetRevNum()),e.find("#lblverTSGSSLClient").text(TSGSSLClient.GetRevNum()),$.get("/version.js.txt",function(t){e.find("#lblverWebLogin").text(t.substring(8))}),$("#btnVersionWinClose").on("click",function(){n.closeModal()})})},T=function(t){e.LaunchPrivCertCenter()},N=function(e){e.keyCode==13&&ie_ver<9&&(e.stopPropagation(),e.preventDefault(),p.is(":hidden")?d.click():p.click())},C=function(e){e.keyCode==13&&ie_ver<9&&(e.stopPropagation(),e.preventDefault(),d.click())},k=function(e){n.openModal("pwlost.html",350)},L=function(e){e.stopPropagation(),e.preventDefault(),f.prop("disabled",!0),p.prop("disabled",!0);if(!_(f.val()))return;t.RequestAuthMethod(f.val(),{success:function(e){i=$.extend(i,e),log("auth_method_override: "+JSON.stringify(i)),log("[RequestAuthMethod] success"),D(),e.password_resetable&&m.fadeIn()},failed:function(e,t){f.prop("disabled",!1),t=="Not Found"?($g.showMessageBox("#area_id",r.NoLoginName),f.select().focus()):t=="Internal Server Error"?($g.showMessageBox("#area_id",r.RequireLoginName),f.select().focus()):($g.showMessageBox("#area_id",r.UnknownError+"<br/>"+e+"<br/>"+t),f.select().focus()),p.prop("disabled",!1)}})},A=function(e){e.stopPropagation(),e.preventDefault(),f.val("").prop("disabled",!1).focus(),l.val(""),u.hide(),v.hide(),d.hide(),p.fadeIn().prop("disabled",!1),a.hide()},O=function(e){e.stopPropagation(),e.preventDefault();var n=f.val(),s=l.val();if(!_(n))return;log("[btnLogin_click] "+n);if(i.auth_method==2||i.auth_method==4)t.RequestLogin(i,n,s,M);else{if(s==undefined||s==""){log("password is blank"),$g.showMessageBox("#area_password",r.RequirePassword),l.focus();return}l.prop("disabled",!0),d.prop("disabled",!0),v.prop("disabled",!0);var o=t.RequestLogin(i,n,s,M);t.savedPassword(),t.savedPassword(s),o||(l.prop("disabled",!1),d.prop("disabled",!1),v.prop("disabled",!1),l.select().focus())}},M={success:function(){log("[RequestLogin_callback] success")},canceled:function(){log("[RequestLogin_callback] canceled"),i.auth_method===2||i.auth_method===4?(p.prop("disabled",!1),f.prop("disabled",!1).select().focus()):(l.prop("disabled",!1),d.prop("disabled",!1),v.prop("disabled",!1),l.select().focus())},failed:function(e,r){log("[RequestLogin_callback] failed"),log(r),log(e);var s;try{s=JSON.parse(r)}catch(o){e>=8e3&&e<9e3?e==t.AXM.AXM_VPN_SESSION_INIT_FAILED?alert("VPN 연결을 초기화할 수 없습니다. 드라이버가 제대로 설치되지 않았거나, 서비스가 중지되었을 수 있습니다. (8003)"):alert("기타 에러 ("+e+")"):alert("알수 없는 에러 ("+e+")");return}var u=s.authCode_usermsg;s.authCode==24&&s.authCode_debugmsg=="password-expired"&&n.openModal("pwchange.html?type=expired&login_name="+f.val(),470);if(s.authCode==2||s.authCode==25)u=s.authCode_usermsg+" (암호 연속 실패: "+s.authOpt+"회)";i.auth_method===2||i.auth_method===4?(p.prop("disabled",!1),f.prop("disabled",!1).select().focus()):(l.prop("disabled",!1),d.prop("disabled",!1),v.prop("disabled",!1),l.select().focus()),a.show(),$g.showMessageBox("#area_error",u)},loginSuccess:function(){log("[RequestLogin_callback] loginSuccess"),$(window).on({beforeunload:function(){return"이 페이지를 나가시겠습니까? 인터넷창 종료시 VPN연결이 유지되고, 작업표시줄의 SSLplus 아이콘에서 접속 종료할 수 있습니다."},unload:function(){t.ActivexTrayEnabled()}}),n.html(g),$g.noTopImage&&$(".s_top_image").addClass("top_fallback"),$g.noNoticeImage&&$(".s_notice_image").addClass("notice_fallback")},connCompleted:function(e,t,r,i){log("[RequestLogin_callback] connCompleted"),log("[RequestLogin_callback] ip address: "+e),log("[RequestLogin_callback] others: "+t+", "+r+", "+i),n.loadStatic("Applist",function(t){t.setIp(e)})},mutexFailed:function(){log("[OnCompleted_RequestLogin] mutexFailed"),i.auth_method===2||i.auth_method===4?(p.prop("disabled",!1),f.prop("disabled",!1).select().focus()):(l.prop("disabled",!1),d.prop("disabled",!1),v.prop("disabled",!1),l.select().focus()),a.show(),$g.showMessageBox("#area_error",r.MutexFailed)},setAuthMethodFailed:function(){log("[OnCompleted_RequestLogin] setAuthMethodFailed"),i.auth_method===2||i.auth_method===4?(p.prop("disabled",!1),f.prop("disabled",!1).select().focus()):(l.prop("disabled",!1),d.prop("disabled",!1),v.prop("disabled",!1),l.select().focus()),a.show(),$g.showMessageBox("#area_error","모든 브라우저를 닫고 다시 시도해주세요.")}},_=function(e){return e==undefined||e==""?($g.showMessageBox("#area_id",r.RequireLoginName),p.prop("disabled",!1),f.prop("disabled",!1).focus(),!1):!0},D=function(){if(i.auth_method===1)u.fadeIn(),p.hide(),d.fadeIn(),v.fadeIn(),l.focus();else if(i.auth_method===2||i.auth_method===4){var e=t.RequestLogin(i,f.val(),l.val(),M);e||(p.prop("disabled",!1),f.prop("disabled",!1).select().focus())}else if(i.auth_method===3||i.auth_method===5)u.fadeIn(),p.hide(),d.fadeIn(),v.fadeIn(),l.focus()};return{init:E}})