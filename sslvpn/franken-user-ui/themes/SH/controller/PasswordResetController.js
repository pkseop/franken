define(["jquery","view/"+$g.theme+"/pagemap.res.js","controller/PageController","controller/SSLClientController.js","controller/ConnectionController.js","sslplus.util","view/"+$g.theme+"/message.res.js"],function(e,t,n,r,i,s,o){var u=function(){function u(e,i,o){e==null&&(e=window);var u=e.$;u("#do_change").off("click"),u("input[type=password]").off("keydown"),u("input[type=password]").val(""),u("input[type=hidden]#login_name").val(o),u("form").on("keydown",function(e){e.keyCode===27&&(e.preventDefault(),e.stopPropagation())}),u("#do_change").on("click",function(e){e.stopPropagation(),e.preventDefault();var o=u("#password_old").val(),a=u("#password_new").val(),f=u("#password_re").val();a==""?(u("#area_new .help-block").text("암호를 입력하세요").fadeIn(),u("#area_new").addClass("error"),u("#area_new input").focus()):f==""?(u("#area_re .help-block").text("암호를 입력하세요").fadeIn(),u("#area_re").addClass("error"),u("#area_re input").focus()):a!==f?(u("#area_re .help-block").text("두 암호가 서로 다릅니다.").fadeIn(),u("#area_re").addClass("error"),u("#area_re input").focus()):s.checkValidPassword(a)?o===a?(u("#area_new .help-block").text("새 암호가 이전 암호와 같을 수 없습니다.").fadeIn(),u("#area_new").addClass("error"),u("#area_new input").focus()):i?r.RequestInternalHttps("POST","/reset/change",u("#change").serialize(),5,function(e,n,r){log(e);if(e===200){log(n);try{var i=JSON.parse(n);i.result=="success"?(alert("암호를 변경하였습니다."),t.hideChange()):i.result=="old_password_not_match"&&(u("#area_old .help-block").text("기존 암호가 틀립니다.").fadeIn(),u("#area_old").addClass("error"),u("#area_old input").focus())}catch(s){alert("JSON error ("+s+")\n암호 변경에 실패하였습니다.")}}else log(e+" Client Error"),alert("클라이언트 에러 ("+e+")\n암호 변경에 실패하였습니다.")}):u.post("/reset/change",u("#change").serialize(),function(e){parent.log(JSON.stringify(e)),e.result=="success"?(alert("암호를 재설정하였습니다."),parent.$("input[type=password]").val(""),n.closeModal()):e.result=="old_password_not_match"&&(alert("기존 암호가 틀립니다."),n.closeModal(),parent.$("input[type=password]").focus())}).error(function(e,t,n){parent.log(e.status+" "+n),alert(e.status+" "+n+"\n암호 재설정에 실패하였습니다.")}):(u("#area_new .help-block").text("암호는 9자 이상의 영문, 숫자, 특수문자 조합으로 만들어야 합니다.").fadeIn(),u("#area_new").addClass("error"),u("#area_new input").focus())}),u("input[type=password]").on("keydown",function(e){var t=window.ie_ver;t==undefined&&(t=parent.ie_ver),e.keyCode==13&&t<8?u("#do_change").click():(u(this).parents(".control-group").removeClass("error"),u(this).next().text(""))}),u("#area_old input[type=password]").focus()}var t=this;this.showChange=function(t){$g.showChangeUI?($g.showChangeUI(),u(null,!0,t),e("#area_old").show()):n.openModal("pwchange.html?type=change&login_name="+t,450)},this.forceChange=function(e){n.openModal("pwchange.html?type=force&login_name="+e,400,null,{showCloseButton:!1})},this.initChange=function(t){e("#change_msg").html(String.format(o.ChangePassword,t)),u(null,!0,t),e("#area_old").show()},this.initForceChange=function(t){e("#change_msg").html(String.format(o.ChangePasswordForce,t)),u(null,!0,t),e("#change h4").text("암호 설정"),e("#password_old").val(i.savedPassword()),e("#password_new").focus()},this.hideChange=function(){$g.hideChangeUI?($g.hideChangeUI(),e(".top_notice").remove()):(n.closeModal(),e(".top_notice").remove())},this.showExpired=function(t,n){e("#change_msg").html(String.format(o.ChangePasswordExpired,t)),u(null,!1,t),e("#password_old").val(n)}};return new u})