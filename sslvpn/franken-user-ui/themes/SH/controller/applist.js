define(["controller/SSLClientController.js","controller/ConnectionController.js","controller/PageController.js","controller/PasswordResetController.js","view/"+$g.theme+"/message.res.js","sslplus.util.js"],function(e,t,n,r,i,s){function h(){$("#applist li:visible").length>4?$("#applist").addClass("hasscroll"):$("#applist").removeClass("hasscroll")}function y(t,n){var r;if($g.renderAppInfo)r=$g.renderAppInfo(n,function(){e.StartNativeApp(t)});else{r=$("<li>");var i=$("<a>").attr("href","#").click(function(){e.StartNativeApp(t)}).appendTo(r),s=$("<img>"),o=$("<img>").addClass("typeimg");n.app_type=="WebApp"?o.attr("src","view/"+$g.theme+"/image/app_web.png"):o.attr("src","view/"+$g.theme+"/image/app_windows.png"),ie_ver<8?s.attr("src","view/"+$g.theme+"/image/ssldefault.png"):s.attr("src","data:image/png;base64,"+n.icon),o.appendTo(i),s.appendTo(i),$("<span>"+n.name+"</span>").addClass("underline").appendTo(i),r.on({mouseover:function(){$(this).addClass("hover")},mouseout:function(){$(this).removeClass("hover")}})}return r}var o,u,a,f,l=function(){$g.noTopImage&&$(".s_top_image").addClass("top_fallback"),$g.noNoticeImage&&$(".s_notice_image").addClass("notice_fallback"),d(),e.RequestAppList(c),e.RequestUserInfo(p),v(),m(),g(),n.loadNotice()},c=function(e){e.length==0?$("<li class='noresult'>사용가능한 애플리케이션이 없습니다.</li>").appendTo("#applist"):$.each(e,function(e,t){y(e,t).appendTo("#applist")}),h()},p=function(e){$(".s_id").text(e.login_name),$("#lbl_name").text(e.name);var n=s.secondsToTime(e.password_change_deadline).h,i=Math.floor(n/24);i<e.password_change_alert&&($(".top_notice .msg").html("현재 사용하는 암호의 만료일이 "+i+"일 남았습니다. <a href='#'>암호 변경하러 가기</a>"),$(".top_notice").on("click",function(){$(this).fadeOut(),r.showChange(e.login_name)}),setTimeout(function(){$(".top_notice").css("margin-top","-32px").animate({"margin-top":"0px"},1e3,"easeOutQuart").show()},800)),a=e.login_name,e.force_password_change?r.forceChange(a):t.savedPassword(),e.password_resetable?$("#btn_change_password").show():$("#btn_change_password").hide(),e.idle_time_out===0&&$("#area_timeout").hide(),t.pollIdleTimeout(e.idle_time_out*1e3,function(e){var t=Math.round(e/1e3),n=s.secondsToTime(t);t===3600?$("#lbl_timeout").text("60:00"):$("#lbl_timeout").text(n.m+":"+n.s)})},d=function(){o=$("#btn_change_password"),u=$("#btn_logout")},v=function(){f!=null&&clearInterval(f);var e=1;f=setInterval(function(){var t=s.secondsToTime(e++);$("#lbl_timer").text(t.h+":"+t.m+":"+t.s)},1e3)},m=function(){$("#search_app").keyup(function(e){$("#applist").removeClass("hasscroll"),$("#applist li.justone").removeClass("justone"),$("#applist li.noresult").remove();var t=$("#search_app").val().toLowerCase();t==""?$("#applist li").show():$.each($("#applist li"),function(e,n){var r=$(this).text().toLowerCase();r.indexOf(t)>=0?$(this).show():$(this).hide()});var n=$("#applist li:visible").length;n==1?$("#applist li:visible").addClass("justone"):n==0&&$("<li class='noresult'>결과가 없습니다.</li>").appendTo("#applist"),h()}).keypress(function(e){this.focus();if(e.keyCode==13)return!1}),$("#search_app").focus()},g=function(){u.on("click",function(){t.ConfirmLogout()}),o.on("click",function(){r.showChange(a)})},b=function(e){$("#lbl_ip").text(e)};return{init:l,setIp:b}})