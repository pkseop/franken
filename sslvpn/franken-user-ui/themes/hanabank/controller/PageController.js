define(["jquery","view/"+$g.theme+"/pagemap.res.js","controller/ConnectionController.js","sslplus.util"],function(e,t,n,r){function s(e){var t,n=[],r=window.location.href.slice(window.location.href.indexOf("?")+1).split("&");for(var i=0;i<r.length;i++)t=r[i].split("="),n.push(t[0]),n[t[0]]=t[1];return e!=null?n[e]:n}var i=function(){function a(t,n){n==1&&e(t).show()}s("logger")=="true"&&r.logger.on();var i=this,o=null,u=0;this.loadCss=function(t,n,r){var i=document.createElement("link");e(i).attr("data-id",t),i.type="text/css",i.rel="stylesheet",i.href=n,i.onload=function(){r!=0&&(u++,r&&r(n))},document.getElementsByTagName("head")[0].appendChild(i)},this.html=function(t){e("#pageview").empty().html(t)},this.load=function(t,n){o&&o.abort(),o=e.get(t,function(t){e("#pageview").html(t)})},this.preload=function(t,n){o=e.get(t,function(e){n(e)})},this.loadNotice=function(){o=e.get("external/notice",function(t){e(".s_notice_content").html(t)})},this.preloadStatic=function(r,i){function a(t){var n=[];e.each(u.css,function(t,r){e("link[data-id="+r.id+"]").length===0&&e.get(s+r.url,function(e){n.push(e)})}),ie_ver===6&&e.each(u.cssie6,function(t,r){e.get(s+r.url,function(e){n.push(e)})}),i!=null&&(u.js!=null?require(["../../"+u.js],function(r){var s={load:function(i){e("#pageview").empty().html(t),e.each(n,function(t,n){e("<style>").text(n).prependTo("#pageview")}),r.init(),i!=null&&i()},ctx:r};i(s)}):i())}function f(){o=e.ajax({url:s+u.html,timeout:1e4}).done(a).error(function(t,r,i){retry_count++,retry_count>2?(window._jqXHR=t,t.status===0&&t.readyState===0&&(alert("웹페이지 연결 상태에 문제가 발생했습니다"),e(window).off(),n.CancelLogin(),location.reload())):f()})}var s="view/"+$g.theme+"/",u=t[r];o&&o.abort(),f()},this.loadStatic=function(r,s){function l(t){function n(n){log("cssload:"+u+"/"+f.css.length),e("#pageview").empty(),u===f.css.length&&(log("css loaded!"),e("#pageview").html(t),f.onload!=null&&f.onload(),s!=null&&(f.js!=null?require(["../../"+f.js],function(t){t.init(),s(t),e("form").on("keydown",function(e){e.keyCode===27&&(e.preventDefault(),e.stopPropagation())})}):s()),u=0,e("#pageview").text()==""&&e("#pageview").html(t))}e.each(f.css,function(t,r){e("link[data-id="+r.id+"]").length>0?(u++,u===f.css.length&&n(a+r.url)):(i.loadCss(r.id,a+r.url,n),e.browser.webkit&&setTimeout(function(){u++,n(a+r.url)},500))}),ie_ver===6&&e.each(f.cssie6,function(e,t){i.loadCss(t.id,a+t.url,!1)})}function h(){o=e.ajax({url:a+f.html,timeout:1e4}).done(l).error(function(t,r,i){c++,c>2?(window._jqXHR=t,t.status===0&&t.readyState===0&&(alert("웹페이지 연결 상태에 문제가 발생했습니다"),e(window).off(),n.CancelLogin(),location.reload())):h()})}var a="view/"+$g.theme+"/",f=t[r];o&&o.abort();var c=0;h()},this.linkClientDownload=function(){e.get("/external/global_config",function(t){try{log(t);var n=JSON.parse(t).global_config;a(".s_cldn_cont",n.show_manual_download),a(".s_cldn.ios",n.show_ios_client_download),a(".s_cldn.windows",n.show_windows_client_download),a(".s_cldn.android",n.show_android_client_download),a(".s_cldn.linux",n.show_linux_client_download)}catch(r){e(".s_cldn").show()}}).error(function(){e(".s_cldn").show()}).complete(function(){e(".s_cldn.windows").on("click",function(){location.href="/setup_"+document.domain+".exe"}),e(".s_cldn.linux").on("click",function(){location.href="/spclient-1.0.1-201111.i386.tgz"}),e(".s_cldn.ios").on("click",function(){location.href="itms-services://?action=download-manifest&url=http://"+document.location.host+"/ios/SSLplus.plist"}),e(".s_cldn.android").on("click",function(){location.href="/SSLplus.apk"}),e(".s_cldn_cont").on("click",function(){location.href="/sslplus.pdf"})})},this.openModal=function(t,n,r,s){var o=!0;s!=null&&s.hasOwnProperty("showCloseButton")&&(o=s.showCloseButton),e("<div>").addClass("modal-backdrop").appendTo("body");var u=e("<div>").addClass("modal").height(n).appendTo("body"),a=e("<button>").addClass("modal-close").on("click",function(){return i.closeModal()});o||a.hide(),a.appendTo(u);var f=e("<iframe>").addClass("modal-iframe").attr("frameborder","0").attr("allowTransparency","true").attr("src",t).appendTo(u),l=f.get(0).contentWindow;return f.load(function(){r!=null&&r(l)}),l},this.resizeModal=function(e,t){t==undefined&&(t=window),t.$(".modal").animate({height:e+"px"},500,"easeOutQuart")},this.closeModal=function(){var e=parent.$;e==undefined&&(e=parent.parent.$),e(".modal").remove(),e(".modal-backdrop").remove()},this.referer=function(){return window.location.pathname}};return new i})